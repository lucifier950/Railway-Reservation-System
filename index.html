<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Reservation System - Connected to C++ Backend</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        // Check login status on every page load
        const userRole = localStorage.getItem('userRole');
        const isLoggedIn = localStorage.getItem('isLoggedIn');

        if (isLoggedIn !== 'true' || !userRole) {
            window.location.href = 'login.html'; // Redirect to login if not authenticated
        }

        // Expose role globally for script.js to use
        window.USER_ROLE = userRole;
    </script>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1>ğŸš‚TICKET BOOKING SYSTEM</h1>
                <button onclick="logout()" class="btn-secondary" style="width: auto; margin: 0; padding: 8px 15px;">ğŸ‘‹ Logout (<span id="roleDisplay"></span>)</button>
            </div>
            <p class="subtitle">âš ï¸Admin Confirmation Required</p>
            <div id="serverStatus" class="status disconnected">âš ï¸ Connecting to server...</div>
        </header>

        <div class="stats-bar" id="adminStatsBar">
            <div class="stat-card">
                <div class="stat-number" id="pendingCount">0</div>
                <div class="stat-label">Pending Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedCount">0</div>
                <div class="stat-label">Completed Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalStations">8</div> 
                <div class="stat-label">Total Stations</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card" id="bookingCard">
                <h2>ğŸ“ New Booking Request</h2>
                <form id="bookingForm">
                    <div class="form-group">
                        <label for="passengerName">ğŸ‘¤ Passenger Name</label>
                        <input type="text" id="passengerName" placeholder="Enter full name" required>
                    </div>
                    <div class="form-group">
                        <label for="fromStation">ğŸ“ From Station</label>
                        <select id="fromStation" required>
                            <option value="">-- Select Departure --</option>
                            <option value="0">Delhi</option>
                            <option value="1">Agra</option>
                            <option value="2">Jaipur</option>
                            <option value="3">Mumbai</option>
                            <option value="4">Pune</option>
                            <option value="5">Goa</option>
                            <option value="6">Lucknow</option>
                            <option value="7">Muzaffarnagar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="toStation">ğŸ¯ To Station</label>
                        <select id="toStation" required>
                            <option value="">-- Select Destination --</option>
                            <option value="0">Delhi</option>
                            <option value="1">Agra</option>
                            <option value="2">Jaipur</option>
                            <option value="3">Mumbai</option>
                            <option value="4">Pune</option>
                            <option value="5">Goa</option>
                            <option value="6">Lucknow</option>
                            <option value="7">Muzaffarnagar</option>
                        </select>
                    </div>
                    <button type="submit" id="bookBtn">ğŸ« Book Ticket</button>
                </form>
            </div>

            <div class="card" id="routeCard">
                <h2>ğŸ” Find Best Route</h2>
                <form id="routeForm">
                    <div class="form-group">
                        <label for="routeFrom">ğŸ“ From Station</label>
                        <select id="routeFrom" required>
                            <option value="">-- Select Departure --</option>
                            <option value="0">Delhi</option>
                            <option value="1">Agra</option>
                            <option value="2">Jaipur</option>
                            <option value="3">Mumbai</option>
                            <option value="4">Pune</option>
                            <option value="5">Goa</option>
                            <option value="6">Lucknow</option>
                            <option value="7">Muzaffarnagar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="routeTo">ğŸ¯ To Station</label>
                        <select id="routeTo" required>
                            <option value="">-- Select Destination --</option>
                            <option value="0">Delhi</option>
                            <option value="1">Agra</option>
                            <option value="2">Jaipur</option>
                            <option value="3">Mumbai</option>
                            <option value="4">Pune</option>
                            <option value="5">Goa</option>
                            <option value="6">Lucknow</option>
                            <option value="7">Muzaffarnagar</option>
                        </select>
                    </div>
                    <button type="submit" id="routeBtn">ğŸš€ Find Routes</button>
                </form>
                <div id="routeResult"></div>
            </div>

            <div class="card network-viz">
                <h2>ğŸ—ºï¸ Railway Network Visualization</h2>
                <div id="network"></div>
            </div>

            <div class="card bookings-list" id="queueCard">
                <h2>ğŸ“‹ Booking Queue Management</h2>
                <button onclick="refreshBookings()" class="btn-secondary">ğŸ”„ Refresh Now</button>
                <div id="bookingsList" class="loading">â³ Loading bookings...</div>
            </div>
            
            <div class="card bookings-list" id="passengerMessage" style="display: none; grid-column: 1 / -1; padding: 50px;">
                <h2 style="border-color: #4caf50;">âœ… Booking Status (Passenger View)</h2>
                
                <p style="font-size: 1.2em; color: #555; margin-bottom: 20px;">Your booking requests are submitted to the queue and await **Admin confirmation**.</p>

                <div id="passengerCompletedList">
                    <h3>Confirmed Tickets</h3>
                    <div class="loading">â³ Checking confirmed bookings...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>